# MESH

Python package helping to work with the MESH dataset. This package is currently primarily focused on the chemicals and drugs category of the MESH dataset.

## Installation

At this moment, the package is not available on PyPI. To install it, you can clone the repository and install it using `pip`:

```bash
pip install .
```

## Usage

The package provides two main functionalities: downloading a pre-built MESH dataset and generating a custom MESH dataset. Once you have the dataset, you can use the `Dataset` class to work with it.

### Downloading a pre-built MESH dataset

While this package allows you to build a custom MESH dataset, since building the dataset requires reources, we also provide pre-built datasets which [we host on Zenodo](). The structure of any of the hosted tarballs is as follows:

```
mesh_chemistry_2024.tar.gz
├── chemicals.csv
├── descriptors.csv
├── chemicals_to_descriptors.csv
├── mesh_dag.csv
├── metadata.json
```

Where (you can see examples of these files just below):
- `chemicals.csv` contains information about chemicals and drugs.
- `descriptors.csv` contains information about descriptors.
- `chemicals_to_descriptors.csv` contains the relationships between chemicals and descriptors.
- `mesh_dag.csv` contains the Directed Acyclic Graph (DAG) of the MESH dataset.
- `metadata.json` contains metadata about the dataset.

To download a pre-built dataset, you can use the following code:

```python
```

Find the available rasterized datasets [on Zenodo]().

### Generating a custom MESH dataset

The package provides a `Dataset` class that allows you to work with the MESH dataset. The dataset is built using the `DatasetSettings` class, which allows you to specify which parts of the dataset you want to include. The `ChemicalsAndDrugsSettings` class allows you to specify which parts of the chemicals and drugs category you want to include.

Particularly helpful, is the ability to include SMILES and InChI keys for the chemicals and drugs. This is done by specifying the `include_smiles` and `include_inchi_keys` methods of the `ChemicalsAndDrugsSettings` class.

```python
from mesh.settings import DatasetSettings, ChemicalsAndDrugsSettings
from mesh import Dataset


def build_mesh_chemistry_2024() -> Dataset:
    """Build MESH 2024 dataset."""
    # First, we need to define the settings for the dataset.
    cad: ChemicalsAndDrugsSettings = (
        ChemicalsAndDrugsSettings()
        # In this case, we are including all of the submodules of
        # categories of chemicals and drugs.
        .include_all_submodules()
        # We also want to include SMILES, which we obtain from the
        # PUBCHEM database.
        .include_smiles()
        # Analogously, we want to include InChI keys, which we obtain
        # from the PUBCHEM database.
        .include_inchi_keys()
    )
    settings = (
        # We are using the MESH 2024 version.
        DatasetSettings(version=2024)
        # We want to retrieve data only regarding chemicals and drugs.
        .include_chemicals_and_drugs(cad)
        # And we want to print the progress of the dataset retrieval.
        .set_verbose(True)
    )
    # Now, we build the dataset. This will download the necessary files
    # and rasterize the dataset.
    dataset = Dataset.build(settings)
    return dataset


if __name__ == "__main__":
    # We build the MESH 2024 dataset.
    mesh_chemistry_2024: Dataset = build_mesh_chemistry_2024()
    # And we save it to disk.
    mesh_chemistry_2024.save("mesh_chemistry_2024", tarball=False)
```

#### Resulting CSVs

The resulting CSVs will be saved in the `mesh_chemistry_2024` directory. The directory will contain the following CSVs:

##### `chemicals.csv`

|unique_identifier|name                                   |compound_id|substance_id|smiles                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |inchi                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |inchikey                   |
|-----------------|---------------------------------------|-----------|------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------|
|C000002          |bevonium                               |31800.0    |500762995.0 |C[N+]1(CCCCC1COC(=O)C(C2=CC=CC=C2)(C3=CC=CC=C3)O)C                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |InChI=1S/C22H28NO3/c1-23(2)16-10-9-15-20(23)17-26-21(24)22(25,18-11-5-3-6-12-18)19-13-7-4-8-14-19/h3-8,11-14,20,25H,9-10,15-17H2,1-2H3/q+1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |UHUMRJKDOOEQIG-UHFFFAOYSA-N|
|C000006          |insulin, neutral                       |118984380.0|497691791.0 |CC[C@H](C)[C@H]1C(=O)N[C@H]2CSSC[C@@H](C(=O)N[C@@H](CSSC[C@@H](C(=O)NCC(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@H](C(=O)N[C@@H](CSSC[C@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC(=O)[C@@H](NC2=O)CO)CC(C)C)CC3=CC=C(C=C3)O)CCC(=O)N)CC(C)C)CCC(=O)O)CC(=O)N)CC4=CC=C(C=C4)O)C(=O)N[C@@H](CC(=O)N)C(=O)O)C(=O)NCC(=O)N[C@@H](CCC(=O)O)C(=O)N[C@@H](CCCNC(=N)N)C(=O)NCC(=O)N[C@@H](CC5=CC=CC=C5)C(=O)N[C@@H](CC6=CC=CC=C6)C(=O)N[C@@H](CC7=CC=C(C=C7)O)C(=O)N[C@@H]([C@@H](C)O)C(=O)N8CCC[C@H]8C(=O)N[C@@H](CCCCN)C(=O)N[C@@H](C)C(=O)O)C(C)C)CC(C)C)CC9=CC=C(C=C9)O)CC(C)C)C)CCC(=O)O)C(C)C)CC(C)C)CC2=CNC=N2)CO)NC(=O)[C@H](CC(C)C)NC(=O)[C@H](CC2=CNC=N2)NC(=O)[C@H](CCC(=O)N)NC(=O)[C@H](CC(=O)N)NC(=O)[C@H](C(C)C)NC(=O)[C@H](CC2=CC=CC=C2)N)C(=O)N[C@H](C(=O)N[C@H](C(=O)N1)CO)[C@@H](C)O)NC(=O)[C@H](CCC(=O)N)NC(=O)[C@H](CCC(=O)O)NC(=O)[C@H](C(C)C)NC(=O)[C@H]([C@@H](C)CC)NC(=O)CN|InChI=1S/C256H381N65O76S6/c1-29-131(23)205(313-193(337)104-258)251(391)317-204(130(21)22)247(387)288-159(75-82-200(347)348)217(357)282-156(71-78-189(262)333)221(361)308-183-116-401-402-117-184-242(382)305-178(111-323)239(379)294-162(88-123(7)8)224(364)295-168(95-140-53-61-146(327)62-54-140)227(367)283-154(69-76-187(260)331)218(358)290-161(87-122(5)6)222(362)285-158(74-81-199(345)346)220(360)302-174(101-190(263)334)234(374)298-170(97-142-57-65-148(329)66-58-142)230(370)309-182(241(381)304-176(255(396)397)103-192(265)336)115-400-399-114-181(213(353)272-107-194(338)278-153(72-79-197(341)342)216(356)281-151(51-42-84-270-256(266)267)211(351)271-108-195(339)279-166(93-138-46-36-32-37-47-138)226(366)297-167(94-139-48-38-33-39-49-139)229(369)299-171(98-143-59-67-149(330)68-60-143)237(377)320-208(136(28)326)253(393)321-85-43-52-186(321)245(385)286-152(50-40-41-83-257)214(354)277-134(26)254(394)395)311-249(389)203(129(19)20)316-235(375)164(90-125(11)12)292-228(368)169(96-141-55-63-147(328)64-56-141)296-223(363)160(86-121(3)4)289-209(349)133(25)276-215(355)157(73-80-198(343)344)287-246(386)202(128(17)18)315-236(376)165(91-126(13)14)293-232(372)173(100-145-106-269-120-275-145)301-238(378)177(110-322)280-196(340)109-273-212(352)180(113-398-403-118-185(310-243(183)383)244(384)319-207(135(27)325)252(392)306-179(112-324)240(380)318-206(132(24)30-2)250(390)312-184)307-225(365)163(89-124(9)10)291-231(371)172(99-144-105-268-119-274-144)300-219(359)155(70-77-188(261)332)284-233(373)175(102-191(264)335)303-248(388)201(127(15)16)314-210(350)150(259)92-137-44-34-31-35-45-137/h31-39,44-49,53-68,105-106,119-136,150-186,201-208,322-330H,29-30,40-43,50-52,69-104,107-118,257-259H2,1-28H3,(H2,260,331)(H2,261,332)(H2,262,333)(H2,263,334)(H2,264,335)(H2,265,336)(H,268,274)(H,269,275)(H,271,351)(H,272,353)(H,273,352)(H,276,355)(H,277,354)(H,278,338)(H,279,339)(H,280,340)(H,281,356)(H,282,357)(H,283,367)(H,284,373)(H,285,362)(H,286,385)(H,287,386)(H,288,387)(H,289,349)(H,290,358)(H,291,371)(H,292,368)(H,293,372)(H,294,379)(H,295,364)(H,296,363)(H,297,366)(H,298,374)(H,299,369)(H,300,359)(H,301,378)(H,302,360)(H,303,388)(H,304,381)(H,305,382)(H,306,392)(H,307,365)(H,308,361)(H,309,370)(H,310,383)(H,311,389)(H,312,390)(H,313,337)(H,314,350)(H,315,376)(H,316,375)(H,317,391)(H,318,380)(H,319,384)(H,320,377)(H,341,342)(H,343,344)(H,345,346)(H,347,348)(H,394,395)(H,396,397)(H4,266,267,270)/t131-,132-,133-,134-,135+,136+,150-,151-,152-,153-,154-,155-,156-,157-,158-,159-,160-,161-,162-,163-,164-,165-,166-,167-,168-,169-,170-,171-,172-,173-,174-,175-,176-,177-,178-,179-,180-,181-,182-,183-,184-,185-,186-,201-,202-,203-,204-,205-,206-,207-,208-/m0/s1|NOESYZHRGYRDHS-ZYCCASTOSA-N|
|C000009          |N-acetylglucosaminylasparagine         |123826.0   |500203198.0 |CC(=O)N[C@@H]1[C@H]([C@@H]([C@H](O[C@H]1NC(=O)C[C@@H](C(=O)O)N)CO)O)O                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |InChI=1S/C12H21N3O8/c1-4(17)14-8-10(20)9(19)6(3-16)23-11(8)15-7(18)2-5(13)12(21)22/h5-6,8-11,16,19-20H,2-3,13H2,1H3,(H,14,17)(H,15,18)(H,21,22)/t5-,6+,8+,9+,10+,11+/m0/s1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |YTTRPBWEMMPYSW-HRRFRDKFSA-N|
|C000011          |5-(n-acetaminophenylazo)-8-oxyquinoline|114081.0   |484035752.0 |CC(=O)NC1=CC=C(C=C1)N=NC2=C3C=CC=NC3=C(C=C2)O                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |InChI=1S/C17H14N4O2/c1-11(22)19-12-4-6-13(7-5-12)20-21-15-8-9-16(23)17-14(15)3-2-10-18-17/h2-10,23H,1H3,(H,19,22)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |DKRPSSOODLBKPQ-UHFFFAOYSA-N|
|C000015          |N-acetyl-L-arginine                    |67427.0    |500710457.0 |CC(=O)N[C@@H](CCCN=C(N)N)C(=O)O                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |InChI=1S/C8H16N4O3/c1-5(13)12-6(7(14)15)3-2-4-11-8(9)10/h6H,2-4H2,1H3,(H,12,13)(H,14,15)(H4,9,10,11)/t6-/m0/s1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |SNEIUMQYRCDYCH-LURJTMIESA-N|
|C000020          |N-acetylneuraminoyllactose             |           |489852514.0 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           |
|C000021          |acetylnovadral                         |           |            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |                           |


##### `descriptors.csv`

| unique_identifier | name                              | compound_id    | substance_id   | smiles                                                                                                        | inchikey                         |
|-------------------|-----------------------------------|----------------|----------------|---------------------------------------------------------------------------------------------------------------|----------------------------------|
| D000001           | Calcimycin                        | 139593372.0    | 500766157.0    | C[C@@H]1CCC2([C@H](C[C@@H]([C@@H](O2)C(C)C(=O)C3=CC=CN3)C)C)O[C@@H]1CC4=NC5=C(O4)C=CC(=C5C(=O)O)NC             | HIYAVKIYRIFSCZ-LGHBZWQHSA-N      |
| D000002           | Temefos                           | 5392.0         | 500974612.0    | COP(=S)(OC)OC1=CC=C(C=C1)SC2=CC=C(C=C2)OP(=S)(OC)OC                                                            | WWJZWCUNLNYYAU-UHFFFAOYSA-N      |
| D000017           | ABO Blood-Group System            |                |                |                                                                                                               |                                  |
| D000019           | Abortifacient Agents              |                |                |                                                                                                               |                                  |
| D000020           | Abortifacient Agents, Nonsteroidal |                |                |                                                                                                               |                                  |
| D000021           | Abortifacient Agents, Steroidal   |                |                |                                                                                                               |                                  |
| D000036           | Abrin                             |                | 486451862.0    |                                                                                                               |                                  |
| D000040           | Abscisic Acid                     | 5702609.0      | 500195639.0    | CC1=CC(=O)CC([C@]1(/C=C/C(=C/C(=O)O)/C)O)(C)C                                                                  | JLIDBLDQVAYHNE-IBPUIESWSA-N      |



##### `chemicals_to_descriptors.csv`

| chemical | descriptor |
|----------|------------|
| C000002  | D001561    |
| C000006  | D061389    |
| C000009  | D000117    |
| C000011  | D015125    |
| C000015  | D001120    |
| C000020  | D007785    |


##### `mesh_dag.csv`

| parent  | child      |
|---------|------------|
| D000001 | D000095662 |
| D000001 | D001583    |
| D000002 | D063086    |
| D000017 | D001789    |
| D000019 | D012102    |
| D000020 | D000019    |
| D000021 | D000019    |

##### `metadata.json`

```json
{
    "version": 2024,
    "categories": [
        "Chemicals and Drugs"
    ],
    "settings": {
        "chemicals_and_drugs": {
            "submodules": [
                "Chemical Actions and Uses",
                "Chemical and Pharmacologic Phenomena",
                "Chemical Vocabularies",
                "Drug Actions",
                "Pharmacologic Actions"
            ],
            "include_smiles": true,
            "include_inchi_keys": true
        }
    }
}
```

### To NetworkX

Since the MESH dataset is a Directed Acyclic Graph (DAG), you can convert it to a NetworkX graph. This is done by calling the `to_networkx` method of the `Dataset` class.

```python
import networkx as nx

# We convert the MESH dataset to a NetworkX graph.
graph: nx.DiGraph = mesh_chemistry_2024.to_networkx()

# Now, we can use the NetworkX graph as we would any other NetworkX graph.
print(nx.info(graph))
```

In this case, the output will be:

```
DiGraph with 334220 nodes and 367694 edges 
```

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.